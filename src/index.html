<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tile Shuffle Synth</title>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <header>
      <div class="row">
        <label class="file">
          <input id="file" type="file" accept="image/*" />
          <span>Select image</span>
        </label>

        <button id="btnReset" disabled>Reset</button>
        <button id="btnRandomize" disabled>Randomize</button>
        <button id="btnPlay" disabled>Play</button>
        <button id="btnStep" disabled>Step</button>
        <button id="btnSortRows" disabled>Sort Rows</button>
        <button id="btnSortCols" disabled>Sort Columns</button>

        <label class="toggle">
          <input id="chkOverlay" type="checkbox" checked />
          <span>Overlay</span>
        </label>

        <label class="toggle">
          <input id="chkVector" type="checkbox" checked />
          <span>Vector (V2)</span>
        </label>

        <label class="toggle">
          <input id="chkRotation" type="checkbox" checked />
          <span>Rotation</span>
        </label>

        <label class="toggle">
          <input id="chkGrowMode" type="checkbox" />
          <span>Grow Mode</span>
        </label>

        <label class="toggle">
          <input id="chkToroidalX" type="checkbox" checked />
          <span>Wrap X</span>
        </label>

        <label class="toggle">
          <input id="chkToroidalY" type="checkbox" checked />
          <span>Wrap Y</span>
        </label>

        <label class="range">
          <span>Speed</span>
          <input id="rngSpeed" type="range" min="1" max="60" value="20" />
          <output id="outSpeed">20</output>
        </label>

        <div class="stats">
          <div>Tiles: <span id="statTiles">-</span></div>
          <div>Attempts/s: <span id="statAps">-</span></div>
          <div>Accepted/s: <span id="statAcc">-</span></div>
          <div>Last Î”: <span id="statDelta">-</span></div>
        </div>
      </div>
    </header>

    <main>
      <div id="stage">
        <canvas id="canvas"></canvas>
        <canvas id="overlay"></canvas>
        <div id="loadingIndicator" class="loading-indicator" style="display: none;">
          <div class="loading-spinner"></div>
          <div class="loading-text">Loading image...</div>
        </div>
      </div>
    </main>

    <script type="module">
      import { init } from "./index.js";

      const getElement = (id) => document.getElementById(id);

      // Collect DOM element references
      const canvas = getElement("canvas");
      const overlay = getElement("overlay");
      const loadingIndicator = getElement("loadingIndicator");

      const controls = {
        btnReset: getElement("btnReset"),
        btnRandomize: getElement("btnRandomize"),
        btnPlay: getElement("btnPlay"),
        btnStep: getElement("btnStep"),
        btnSortRows: getElement("btnSortRows"),
        btnSortCols: getElement("btnSortCols"),
      };

      const stats = {
        tiles: getElement("statTiles"),
        aps: getElement("statAps"),
        acc: getElement("statAcc"),
        delta: getElement("statDelta"),
      };

      const inputs = {
        file: getElement("file"),
        chkOverlay: getElement("chkOverlay"),
        chkVector: getElement("chkVector"),
        chkRotation: getElement("chkRotation"),
        chkGrowMode: getElement("chkGrowMode"),
        chkToroidalX: getElement("chkToroidalX"),
        chkToroidalY: getElement("chkToroidalY"),
        rngSpeed: getElement("rngSpeed"),
        outSpeed: getElement("outSpeed"),
      };

      // Initialize app with canvas and UI elements
      init({ canvas, overlay, controls, stats, inputs, loadingIndicator });
    </script>
  </body>
</html>
